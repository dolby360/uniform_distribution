# Step 8.1: Install Android SDK Command-Line Tools

## Goal

Install the Android SDK command-line tools on Windows without Android Studio. Set up environment variables, accept licenses, and install all required SDK packages so that `sdkmanager`, `avdmanager`, `adb`, and `emulator` are available from the terminal.

## Prerequisites

- JDK 17 installed at `C:\Program Files\Java\jdk-17` (confirmed)
- `JAVA_HOME` set correctly (confirmed)
- Internet connection for downloading SDK (~2GB total)
- ~5GB free disk space (confirmed: 1.5TB available)

## Detailed Actions

### 1. Create Android SDK Directory

```bash
mkdir -p "C:/Users/dolev/Android/Sdk"
```

### 2. Download Android Command-Line Tools

```bash
curl -L -o /tmp/commandlinetools.zip \
  "https://dl.google.com/android/repository/commandlinetools-win-11076708_latest.zip"
```

### 3. Extract and Fix Directory Structure

The zip extracts with a nested `cmdline-tools/` directory. The correct structure must be:
`$ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager.bat`

```bash
# Extract
mkdir -p "C:/Users/dolev/Android/Sdk/cmdline-tools"
unzip /tmp/commandlinetools.zip -d /tmp/cmdline-tools-temp

# Move to correct path (the zip creates a 'cmdline-tools' subfolder)
mv /tmp/cmdline-tools-temp/cmdline-tools "C:/Users/dolev/Android/Sdk/cmdline-tools/latest"
rm -rf /tmp/cmdline-tools-temp
```

**Common Pitfall**: If extracted directly to `cmdline-tools/`, you get `cmdline-tools/cmdline-tools/bin/` which is WRONG. Must be `cmdline-tools/latest/bin/`.

### 4. Set Environment Variables (Session)

```bash
export ANDROID_HOME="C:/Users/dolev/Android/Sdk"
export PATH="$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$ANDROID_HOME/emulator:$PATH"
```

### 5. Verify sdkmanager Works

```bash
sdkmanager --version
```

If `.bat` extension is needed in Git Bash:
```bash
sdkmanager.bat --version
```

### 6. Accept All SDK Licenses

```bash
yes | sdkmanager --licenses
```

### 7. Install Required SDK Packages

```bash
sdkmanager \
  "platform-tools" \
  "platforms;android-34" \
  "build-tools;34.0.0" \
  "emulator" \
  "system-images;android-34;google_apis;x86_64"
```

This downloads approximately:
- `platform-tools`: ~15MB (includes `adb`)
- `platforms;android-34`: ~70MB
- `build-tools;34.0.0`: ~55MB
- `emulator`: ~350MB
- `system-images;android-34;google_apis;x86_64`: ~1.2GB

### 8. (Optional) Set Persistent Environment Variables

For the variables to persist across terminal sessions on Windows:

```bash
# Using setx (Windows command, run from cmd or powershell)
setx ANDROID_HOME "C:\Users\dolev\Android\Sdk"
setx PATH "%PATH%;C:\Users\dolev\Android\Sdk\cmdline-tools\latest\bin;C:\Users\dolev\Android\Sdk\platform-tools;C:\Users\dolev\Android\Sdk\emulator"
```

Or add to `~/.bashrc` for Git Bash:
```bash
echo 'export ANDROID_HOME="C:/Users/dolev/Android/Sdk"' >> ~/.bashrc
echo 'export PATH="$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$ANDROID_HOME/emulator:$PATH"' >> ~/.bashrc
```

## Edge Cases & Troubleshooting

| Issue | Solution |
|-------|----------|
| `sdkmanager` not found | Check path: `ls "$ANDROID_HOME/cmdline-tools/latest/bin/"` |
| Java version error | Ensure `JAVA_HOME` points to JDK 17, not JRE |
| License accept hangs | Use `yes \| sdkmanager --licenses` with pipe |
| Slow download | Packages are large; allow 10-15 min on typical connection |
| `.bat` extension needed | In Git Bash, call `sdkmanager.bat` if plain `sdkmanager` fails |

## Checklist

- [ ] `C:/Users/dolev/Android/Sdk` directory exists
- [ ] Command-line tools extracted to `cmdline-tools/latest/bin/`
- [ ] `ANDROID_HOME` environment variable set
- [ ] `PATH` includes `cmdline-tools/latest/bin`, `platform-tools`, and `emulator`
- [ ] `sdkmanager --version` outputs a version number
- [ ] All SDK licenses accepted (`yes | sdkmanager --licenses`)
- [ ] `platform-tools` installed → `adb --version` works
- [ ] `platforms;android-34` installed
- [ ] `build-tools;34.0.0` installed
- [ ] `emulator` installed → `emulator -version` works
- [ ] `system-images;android-34;google_apis;x86_64` installed
- [ ] `sdkmanager --list_installed` shows all 5 packages
- [ ] Environment variables persisted (in `.bashrc` or via `setx`)

## Validation Commands

```bash
# 1. SDK manager version
sdkmanager --version
# Expected: "12.0" or similar

# 2. ADB available
adb --version
# Expected: "Android Debug Bridge version X.X.X"

# 3. Emulator available
emulator -version
# Expected: "Android emulator version X.X.X.X"

# 4. All packages installed
sdkmanager --list_installed 2>/dev/null | grep -E "platform-tools|platforms;android-34|build-tools;34|emulator|system-images"
# Expected: 5 lines showing installed packages

# 5. ANDROID_HOME set correctly
echo $ANDROID_HOME && test -d "$ANDROID_HOME/platform-tools" && echo "OK"
# Expected: path + "OK"

# 6. Check emulator acceleration
emulator -accel-check
# Expected: "HAXM is installed" or "WHPX is installed" (since Hyper-V is available)
```
