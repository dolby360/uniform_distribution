# Step 8.4: Core App Shell (Application, Activity, Theme, Navigation, HomeScreen)

## Goal

Write the minimal Kotlin source code needed to produce a compiling, launchable Android app. This includes the Hilt Application class, MainActivity, Material 3 theme, navigation graph, Screen routes, and a functional HomeScreen. After this step, the app builds, installs on the emulator, and displays the HomeScreen with a camera FAB button.

## Prerequisites

- Step 8.3 completed (project scaffolded, `./gradlew tasks` works)
- Step 8.2 completed (emulator running for validation)

## Files to Create

All under `android/app/src/main/java/com/uniformdist/app/`:

```
UniformDistApp.kt                    # @HiltAndroidApp Application class
MainActivity.kt                      # @AndroidEntryPoint, Compose setup
di/
  AppModule.kt                       # Hilt module (empty placeholder)
ui/
  theme/
    Color.kt                         # Material 3 color definitions
    Type.kt                          # Typography definitions
    Theme.kt                         # UniformDistTheme composable
  navigation/
    Screen.kt                        # Sealed class with route definitions
    NavGraph.kt                      # NavHost with all screen routes
  screens/
    home/
      HomeScreen.kt                  # Home screen with FAB + description
```

## Key Code

### UniformDistApp.kt

```kotlin
package com.uniformdist.app

import android.app.Application
import dagger.hilt.android.HiltAndroidApp

@HiltAndroidApp
class UniformDistApp : Application()
```

### MainActivity.kt

```kotlin
package com.uniformdist.app

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.navigation.compose.rememberNavController
import com.uniformdist.app.ui.navigation.NavGraph
import com.uniformdist.app.ui.theme.UniformDistTheme
import dagger.hilt.android.AndroidEntryPoint

@AndroidEntryPoint
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            UniformDistTheme {
                val navController = rememberNavController()
                NavGraph(navController = navController)
            }
        }
    }
}
```

### ui/theme/Color.kt

```kotlin
package com.uniformdist.app.ui.theme

import androidx.compose.ui.graphics.Color

val Purple80 = Color(0xFFD0BCFF)
val PurpleGrey80 = Color(0xFFCCC2DC)
val Pink80 = Color(0xFFEFB8C8)

val Purple40 = Color(0xFF6650a4)
val PurpleGrey40 = Color(0xFF625b71)
val Pink40 = Color(0xFF7D5260)
```

### ui/theme/Type.kt

```kotlin
package com.uniformdist.app.ui.theme

import androidx.compose.material3.Typography
import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.sp

val Typography = Typography(
    bodyLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 16.sp,
        lineHeight = 24.sp,
        letterSpacing = 0.5.sp
    )
)
```

### ui/theme/Theme.kt

```kotlin
package com.uniformdist.app.ui.theme

import android.os.Build
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.platform.LocalContext

private val DarkColorScheme = darkColorScheme(
    primary = Purple80,
    secondary = PurpleGrey80,
    tertiary = Pink80
)

private val LightColorScheme = lightColorScheme(
    primary = Purple40,
    secondary = PurpleGrey40,
    tertiary = Pink40
)

@Composable
fun UniformDistTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    dynamicColor: Boolean = true,
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            val context = LocalContext.current
            if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)
        }
        darkTheme -> DarkColorScheme
        else -> LightColorScheme
    }

    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography,
        content = content
    )
}
```

### ui/navigation/Screen.kt

```kotlin
package com.uniformdist.app.ui.navigation

sealed class Screen(val route: String) {
    data object Home : Screen("home")
    data object Camera : Screen("camera")
    data object MatchConfirmation : Screen("match_confirmation/{resultJson}") {
        fun createRoute(resultJson: String): String = "match_confirmation/$resultJson"
    }
    data object Statistics : Screen("statistics")
}
```

**Note**: MatchConfirmation takes a `resultJson` argument — the ProcessOutfitResponse serialized as JSON string. This avoids needing the kotlin-parcelize plugin.

### ui/navigation/NavGraph.kt

At this stage, Camera and MatchConfirmation are stubs. They'll be implemented in Steps 8.6 and 8.7.

```kotlin
package com.uniformdist.app.ui.navigation

import androidx.compose.foundation.layout.*
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.navigation.NavHostController
import androidx.navigation.NavType
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.navArgument
import com.uniformdist.app.ui.screens.home.HomeScreen

@Composable
fun NavGraph(navController: NavHostController) {
    NavHost(navController = navController, startDestination = Screen.Home.route) {
        composable(Screen.Home.route) {
            HomeScreen(
                onTakePhoto = { navController.navigate(Screen.Camera.route) },
                onViewStats = { navController.navigate(Screen.Statistics.route) }
            )
        }
        composable(Screen.Camera.route) {
            // Stub — implemented in Step 8.6
            Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {
                Text("Camera Screen (Coming in Step 8.6)")
            }
        }
        composable(
            route = Screen.MatchConfirmation.route,
            arguments = listOf(navArgument("resultJson") { type = NavType.StringType })
        ) {
            // Stub — implemented in Step 8.7
            Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {
                Text("Match Confirmation (Coming in Step 8.7)")
            }
        }
        composable(Screen.Statistics.route) {
            // Stub — implemented in Step 9
            Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {
                Text("Statistics Screen (Coming in Step 9)")
            }
        }
    }
}
```

### ui/screens/home/HomeScreen.kt

```kotlin
package com.uniformdist.app.ui.screens.home

import androidx.compose.foundation.layout.*
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.CameraAlt
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun HomeScreen(
    onTakePhoto: () -> Unit,
    onViewStats: () -> Unit
) {
    Scaffold(
        topBar = {
            TopAppBar(title = { Text("Uniform Distribution") })
        },
        floatingActionButton = {
            FloatingActionButton(onClick = onTakePhoto) {
                Icon(Icons.Default.CameraAlt, contentDescription = "Take Photo")
            }
        }
    ) { padding ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
                .padding(16.dp),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Text(
                text = "Take a photo of your outfit to log what you're wearing today.",
                style = MaterialTheme.typography.bodyLarge,
                modifier = Modifier.padding(bottom = 24.dp)
            )

            OutlinedButton(onClick = onViewStats) {
                Text("View Statistics")
            }
        }
    }
}
```

### di/AppModule.kt

```kotlin
package com.uniformdist.app.di

import dagger.Module
import dagger.hilt.InstallIn
import dagger.hilt.components.SingletonComponent

@Module
@InstallIn(SingletonComponent::class)
object AppModule
```

## Edge Cases & Troubleshooting

| Issue | Solution |
|-------|----------|
| `@HiltAndroidApp` not found | Ensure `hilt-android` dependency and `ksp("hilt-compiler")` are in build.gradle |
| `Cannot find symbol: Theme.UniformDist` | Verify `themes.xml` has `Theme.UniformDist` style |
| Material 3 import errors | Ensure Compose BOM is correct and `material3` is imported |
| Nav argument encoding issue | URL-encode the JSON string when creating routes (handled in Step 8.7) |
| Dynamic color crash on API < 31 | The theme code checks `Build.VERSION.SDK_INT >= S` before using dynamic colors |
| App crashes on launch | Check `android:name=".UniformDistApp"` in AndroidManifest matches class name |

## Checklist

- [ ] `UniformDistApp.kt` created with `@HiltAndroidApp`
- [ ] `MainActivity.kt` created with `@AndroidEntryPoint` and Compose setup
- [ ] `Color.kt` created with Material 3 color palette
- [ ] `Type.kt` created with Typography configuration
- [ ] `Theme.kt` created with `UniformDistTheme` composable (light/dark/dynamic)
- [ ] `Screen.kt` created with routes: Home, Camera, MatchConfirmation, Statistics
- [ ] `NavGraph.kt` created with all routes (stubs for Camera, Confirmation, Statistics)
- [ ] `HomeScreen.kt` created with TopAppBar, FAB, and description text
- [ ] `AppModule.kt` created (empty Hilt module)
- [ ] `./gradlew assembleDebug` → BUILD SUCCESSFUL
- [ ] APK file exists at `app/build/outputs/apk/debug/app-debug.apk`
- [ ] `adb install -r app-debug.apk` → Success
- [ ] `adb shell am start -n com.uniformdist.app/.MainActivity` → app launches
- [ ] App process running: `adb shell pidof com.uniformdist.app` returns PID
- [ ] HomeScreen visible with "Uniform Distribution" title bar
- [ ] Camera FAB button visible at bottom-right
- [ ] "View Statistics" button visible
- [ ] No crashes in logcat: `adb logcat -d | grep -i "FATAL"` is empty
- [ ] Tapping FAB navigates to Camera stub screen
- [ ] Tapping "View Statistics" navigates to Statistics stub screen

## Validation Commands

```bash
cd c:/Users/dolev/Downloads/personal/uniform_distribution/android

# 1. Build
./gradlew assembleDebug 2>&1 | tail -3
# Expected: "BUILD SUCCESSFUL"

# 2. APK exists
test -f app/build/outputs/apk/debug/app-debug.apk && echo "APK exists"

# 3. Install on emulator
adb install -r app/build/outputs/apk/debug/app-debug.apk
# Expected: "Success"

# 4. Launch
adb shell am start -n com.uniformdist.app/.MainActivity
# Expected: no error

# 5. App is running
sleep 3
adb shell pidof com.uniformdist.app
# Expected: a PID number

# 6. Take screenshot to verify UI
adb shell screencap -p /sdcard/step_8_4_home.png
adb pull /sdcard/step_8_4_home.png ./

# 7. No crashes
adb logcat -d -s AndroidRuntime:E | grep "com.uniformdist" | head -5
# Expected: empty (no crashes)
```
